var e=Object.assign;import{e as t,v as s,w as i,j as a,as as r,k as n,n as o,y as m,G as g,q as d,ey as c,aY as p,ao as l}from"./index.74f7b770.js";import{r as u,B as h}from"./DragVerify.344d95a8.js";import"./vendor.62a151c9.js";import"./useExpose.c23851db.js";var f=t({name:"ImgRotateDargVerify",inheritAttrs:!1,props:u,emits:["success","change","update:value"],setup(t,{emit:u,attrs:f}){const v=s(null),T=i({showTip:!1,isPassing:!1,imgStyle:{},randomRotate:0,currentRotate:0,toOrigin:!1,startTime:0,endTime:0,draged:!1}),{t:y}=a();r((()=>T.isPassing),(e=>{if(e){const{startTime:t,endTime:s}=T;u("success",{isPassing:e,time:((s-t)/1e3).toFixed(1)}),u("change",e),u("update:value",e)}}));const w=n((()=>{const{imgWrapStyle:s,imgWidth:i}=t;return e({width:`${i}px`,height:`${i}px`},s)})),x=n((()=>{const{minDegree:e,maxDegree:s}=t;return e===s?Math.floor(1+1*Math.random())/10+1:1}));function D(){T.startTime=(new Date).getTime()}function P(e){T.draged=!0;const{imgWidth:s,height:i,maxDegree:a}=t,{moveX:r}=e,n=Math.ceil(r/(s-parseInt(i))*a*m(x));T.currentRotate=n,T.imgStyle=c("transform",`rotateZ(${T.randomRotate-n}deg)`)}function R(){const{minDegree:e,maxDegree:s}=t,i=Math.floor(e+Math.random()*(s-e));T.randomRotate=i,T.imgStyle=c("transform",`rotateZ(${i}deg)`)}function S(){const{randomRotate:e,currentRotate:s}=T,{diffDegree:i}=t;Math.abs(e-s)>=(i||20)?(T.imgStyle=c("transform",`rotateZ(${e}deg)`),T.toOrigin=!0,p((()=>{T.toOrigin=!1,T.showTip=!0}),300)):(T.isPassing=!0,T.endTime=(new Date).getTime()),T.showTip=!0}function _(){T.showTip=!1;const e=m(v);e&&(T.isPassing=!1,e.resume(),R())}const M=l();return M&&(M.resume=_),()=>{const{src:s}=t,{toOrigin:i,isPassing:a,startTime:r,endTime:n}=T,c=[];i&&c.push("to-origin");const p=(n-r)/1e3;return o("div",{class:"ir-dv"},[o("div",{class:"ir-dv-img__wrap",style:m(w)},[o("img",{src:s,onLoad:R,width:parseInt(t.width),class:c,style:T.imgStyle,onClick:()=>{_()}},null),T.showTip&&o("span",{class:["ir-dv-img__tip",T.isPassing?"success":"error"]},[T.isPassing?y("component.verify.time",{time:p.toFixed(1)}):y("component.verify.error")]),!T.showTip&&!T.draged&&o("span",{class:["ir-dv-img__tip","normal"]},[g("t('redoTip')")])]),o(h,d({class:"ir-dv-drag__bar",onMove:P,onEnd:S,onStart:D,ref:v},e(e({},f),t),{value:a,isSlot:!0}),null)])}}});export default f;
